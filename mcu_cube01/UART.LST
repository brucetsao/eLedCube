C51 COMPILER V9.00   UART                                                                  11/27/2013 20:27:31 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\HEX\UART.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE UART.C DEBUG OBJECTEXTEND OBJECT(.\HEX\UART.obj)

line level    source

   1          /*********************************************************************************************
   2          程序名： 　　 UART串口中断方式程序实例
   3          编写人： 　　 杜洋　
   4          编写时间：　　2009年9月25日
   5          硬件支持：　　STC12C2052AD　外部12MHZ晶振
   6          接口说明：　　连接串口ISP下载线  
   7          修改日志：　　
   8          　　NO.1-                                                               
   9          /*********************************************************************************************
  10          说明：
  11          用Windows系统中的“超级终端”软件，将串口端设置 [ 4800，8，无，1，无 ]
  12          或采用STC-ISP软件中的串口助手功能，将串口端设置 [ 4800，8，无，1，无 ]
  13          
  14          向串口发送数据，单片机将数据发还给PC端并显示。
  15          
  16          /*********************************************************************************************/
  17          #include "UART.h"
  18          #include "74hc595.h"
  19          #include <string.h>
  20          bit uart_flang=0;
  21          
  22          uint  num=0;
  23          //#include <STC12C2052AD.H> //STC12Cx052或STC12Cx052AD系列单片机头文件
  24          /*********************************************************************************************
  25          函数名：UART串口初始化函数
  26          调  用：UART_init();
  27          参  数：无
  28          返回值：无
  29          结  果：启动UART串口接收中断，允许串口接收，启动T/C2产生波特率（占用）
  30          备  注：振荡晶体为22.1184MHz，PC串口端设置 [ 115200，8，无，1，无 ]
  31          /**********************************************************************************************/
  32          void UART_init (void)
  33          {
  34   1              //EA = 1; //允许总中断（如不使用中断，可用//屏蔽）
  35   1              ES = 1; //允许UART串口的中断
  36   1      
  37   1              SCON = 0x50;            //8位数据,可变波特率
  38   1              AUXR |= 0x04;           //定时器2时钟为Fosc,即1T
  39   1              T2L = 0xD0;             //设定定时初值
  40   1              T2H = 0xFF;             //设定定时初值
  41   1              AUXR |= 0x01;           //串口1选择定时器2为波特率发生器
  42   1              AUXR |= 0x10;           //启动定时器2  
  43   1      }
  44          /**************************************************************************
  45           - 功能描述：51单片机的串口发送字节的函数
  46           - 隶属模块：STC51串口操作
  47           - 函数属性：外部，使用户使用
  48           - 参数说明：ucData:要发送的一个字节
  49           - 返回说明：无
  50           - 注：发送一个字节，是串口发送的基础操作
  51           **************************************************************************/
  52          
  53          void UART_Send_Byte(unsigned char ucData)
  54          {
  55   1       //LED1=1;
C51 COMPILER V9.00   UART                                                                  11/27/2013 20:27:31 PAGE 2   

  56   1       TI = 0;
  57   1       SBUF = ucData;
  58   1       while(!TI);
  59   1       TI = 0;
  60   1       // LED1=0;
  61   1      }
  62          /**********************************************************************************************/
  63          /*********************************************************************************************
  64          函数名：UART串口接收中断处理函数
  65          调  用：[SBUF收到数据后中断处理]
  66          参  数：无
  67          返回值：无
  68          结  果：UART串口接收到数据时产生中断，用户对数据进行处理（并发送回去）
  69          备  注：过长的处理程序会影响后面数据的接收
  70          /**********************************************************************************************/
  71          void UART_R (void) interrupt 4  using 1
  72          //void UART_R(void)
  73          { //切换寄存器组到1
  74   1              //IapReadByte(uint addr);                   //从EEPROM读1字节数据；
  75   1              //IapProgramByte(uint addr, uchar dat); //写1字节数据到EEPROM;
  76   1              //IapEraseSector(uint addr);                //擦除扇区
  77   1              //uchar  i; 
  78   1              uchar UART_data; //定义串口接收数据变量
  79   1              /* if(RI==1)
  80   1          {
  81   1              RI  =   0;
  82   1              UART_data   =   SBUF;
  83   1                      UART_Send_Byte(UART_data);
  84   1          }
  85   1          else
  86   1          {
  87   1              TI  =  0;
  88   1          } 
  89   1              
  90   1               */
  91   1              
  92   1              
  93   1              RI = 0;         
  94   1              //令接收中断标志位为0（软件清零）
  95   1              //pov_dat[num] = SBUF;  //将接收到的数据送入变量 UART_data
  96   1              //P0=SBUF;
  97   1              UART_data= SBUF;
  98   1              //IapEraseSector(0x0001);
  99   1              //IapProgramByte(0x0001, UART_data);    
 100   1              //SBUF=IapReadByte(0x0001);
 101   1              UART_Send_Byte(IapReadByte(0x0001));
 102   1              //SBUF = UART_data;     //将接收的数据发送回去（删除//即生效）
 103   1      //      while(TI == 1);         //检查发送中断标志位
 104   1              //while(!TI);
 105   1              //TI = 0;               //令发送中断标志位为0（软件清零）
 106   1      
 107   1               
 108   1      }
 109                  
 110          
 111          
 112          /**************************************************************************
 113           - 功能描述：51单片机的串口发送0d 0a ，即回车换行
 114           - 隶属模块：STC51串口操作
 115           - 函数属性：外部，使用户使用
 116           - 参数说明：无
 117           - 返回说明：无
C51 COMPILER V9.00   UART                                                                  11/27/2013 20:27:31 PAGE 3   

 118           - 注：此函数就是发送0d 0a这两个字节，在“超级终端”上会有回车换行的效果
 119           **************************************************************************/
 120          
 121          void UART_Send_Enter()
 122          {
 123   1       UART_Send_Byte(0x0d);
 124   1       UART_Send_Byte(0x0a);
 125   1      }
 126          
 127          /**************************************************************************
 128           - 功能描述：51单片机的串口发送字符串
 129           - 隶属模块：STC51串口操作
 130           - 函数属性：外部，使用户使用
 131           - 参数说明：s:指向字符串的指针
 132           - 返回说明：无
 133           - 注：发送完一条字符串，回车
 134           **************************************************************************/
 135          
 136          void UART_Send_Str(char *pStr)
 137          {
 138   1          
 139   1              while(*pStr != '\0')
 140   1              {
 141   2                      UART_Send_Byte(*pStr++);
 142   2              }
 143   1              UART_Send_Enter();
 144   1      
 145   1      }
 146          
 147          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    119    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
